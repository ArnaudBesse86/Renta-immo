<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur d'investissement locatif</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md mt-10">
        <h1>Sur Github</h1>
        <div id="visitSimulation" class="mb-4">
            <button onclick="simulateVisit(1)" class="bg-blue-500 text-white px-4 py-2 rounded">Simuler première visite</button>
            <button onclick="simulateVisit(2)" class="bg-blue-500 text-white px-4 py-2 rounded">Simuler deuxième visite</button>
            <button onclick="simulateVisit(3)" class="bg-blue-500 text-white px-4 py-2 rounded">Simuler visites suivantes</button>
        </div>

        <div id="loginContainer" style="display: none;">
            <h2 class="text-xl font-bold mb-4">Connexion</h2>
            <div>
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" class="w-full border p-2 mb-2">
            </div>
            <div>
                <label for="loginPassword">Mot de passe</label>
                <input type="password" id="loginPassword" class="w-full border p-2 mb-2">
            </div>
            <button onclick="login()" class="bg-green-500 text-white px-4 py-2 rounded">Se connecter</button>
            <p class="mt-2">Pas encore de compte ? <a href="#" onclick="showRegister()" class="text-blue-500">S'inscrire</a></p>
        </div>

        <div id="registerContainer" style="display: none;">
            <h2 class="text-xl font-bold mb-4">Création de compte</h2>
            <div>
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" class="w-full border p-2 mb-2">
            </div>
            <div>
                <label for="registerPassword">Mot de passe</label>
                <input type="password" id="registerPassword" class="w-full border p-2 mb-2">
            </div>
            <div>
                <label for="registerName">Nom</label>
                <input type="text" id="registerName" class="w-full border p-2 mb-2">
            </div>
            <div>
                <label for="registerFirstName">Prénom</label>
                <input type="text" id="registerFirstName" class="w-full border p-2 mb-2">
            </div>
            <div>
                <label for="registerBirthDate">Date de naissance</label>
                <input type="date" id="registerBirthDate" class="w-full border p-2 mb-2">
            </div>
            <div>
                <label for="registerAddress">Adresse</label>
                <input type="text" id="registerAddress" class="w-full border p-2 mb-2">
            </div>
            <button onclick="register()" class="bg-green-500 text-white px-4 py-2 rounded">Créer un compte</button>
            <p class="mt-2">Déjà un compte ? <a href="#" onclick="showLogin()" class="text-blue-500">Se connecter</a></p>
        </div>

        <div id="calculatorContainer" style="display: none;">
            <h2 class="text-2xl font-bold mb-6">Calculateur de rentabilité d'investissement locatif</h2>
            <div>
                <label for="propertyPrice">Prix du bien (€)</label>
                <input type="number" id="propertyPrice" class="w-full border p-2 mb-2" oninput="calculateNotaryFees()">
            </div>
            <div>
                <label for="notaryFees">Frais de notaire (€)</label>
                <input type="number" id="notaryFees" class="w-full border p-2 mb-2" readonly>
            </div>
            <div>
                <label>
                    <input type="checkbox" id="noLoan" onchange="toggleLoanFields()"> Sans emprunt
                </label>
            </div>
            <div id="loanFields">
                <div>
                    <label for="downPayment">Apport (€)</label>
                    <input type="number" id="downPayment" class="w-full border p-2 mb-2">
                </div>
                <div>
                    <label for="loanAmount">Montant du prêt (€)</label>
                    <input type="number" id="loanAmount" class="w-full border p-2 mb-2">
                </div>
                <div>
                    <label for="loanDuration">Durée de l'emprunt (années)</label>
                    <input type="number" id="loanDuration" class="w-full border p-2 mb-2">
                </div>
                <div>
                    <label for="interestRate">Taux d'intérêt annuel (%)</label>
                    <input type="number" id="interestRate" step="0.1" class="w-full border p-2 mb-2" value="3.5">
                </div>
            </div>
            <div>
                <label for="monthlyRent">Loyer mensuel estimé (€)</label>
                <input type="number" id="monthlyRent" class="w-full border p-2 mb-2">
            </div>
            <div>
                <label for="propertyTax">Taxe foncière annuelle (€)</label>
                <input type="number" id="propertyTax" class="w-full border p-2 mb-2">
            </div>
            <div>
                <label for="coownershipCharges">Charges de copropriété annuelles (€)</label>
                <input type="number" id="coownershipCharges" class="w-full border p-2 mb-2">
            </div>
            <div>
                <label for="insurance">Assurance annuelle (€)</label>
                <input type="number" id="insurance" class="w-full border p-2 mb-2">
            </div>
            <div>
                <label for="managementFees">Frais de gestion locative (%)</label>
                <input type="number" id="managementFees" step="0.1" class="w-full border p-2 mb-2">
            </div>
            <button onclick="calculateProfitability()" class="bg-blue-500 text-white px-4 py-2 rounded">Calculer la rentabilité</button>
        </div>

        <div id="resultat" class="mt-6 p-4 bg-gray-200 rounded" style="display: none;">
            <h3 class="text-xl font-semibold mb-2">Résultats :</h3>
            <div id="resultatsContenu"></div>
        </div>
    </div>

    <script>
        let visitCount = 0;

        function simulateVisit(visitNumber) {
            visitCount++;
            if (visitCount === 1) {
                showCalculator();
				console.log(visitCount);
				console.log(visitNumber);
				
            } else {
                const user = JSON.parse(localStorage.getItem('user'));
                if (user) {
                    showCalculator();
					console.log("user" + visitCount);
					console.log(user);
                } else {
                    showLogin();
					console.log("no user" + visitCount);
                }
            }
        }

        function showLogin() {
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('registerContainer').style.display = 'none';
            document.getElementById('calculatorContainer').style.display = 'none';
        }

        function showRegister() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('registerContainer').style.display = 'block';
            document.getElementById('calculatorContainer').style.display = 'none';
        }

        function showCalculator() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('registerContainer').style.display = 'none';
            document.getElementById('calculatorContainer').style.display = 'block';
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                localStorage.setItem('user', JSON.stringify(user));
                showCalculator();
            } else {
                alert("Email ou mot de passe incorrect.");
            }
        }

        function register() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const name = document.getElementById('registerName').value;
            const firstName = document.getElementById('registerFirstName').value;
            const birthDate = document.getElementById('registerBirthDate').value;
            const address = document.getElementById('registerAddress').value;

            if (email && password && name && firstName && birthDate && address) {
                const users = JSON.parse(localStorage.getItem('users')) || [];
                if (users.some(u => u.email === email)) {
                    alert("Un compte avec cet email existe déjà.");
                    return;
                }
                const newUser = {email, password, name, firstName, birthDate, address};
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('user', JSON.stringify(newUser));
                showCalculator();
            } else {
                alert("Veuillez remplir tous les champs.");
            }
        }

        function toggleLoanFields() {
            const loanFields = document.getElementById('loanFields');
            const noLoan = document.getElementById('noLoan');
            loanFields.style.display = noLoan.checked ? 'none' : 'block';
        }

        function calculateNotaryFees() {
            const propertyPrice = parseFloat(document.getElementById('propertyPrice').value) || 0;
            let notaryFees;
            if (propertyPrice <= 6500) {
                notaryFees = propertyPrice * 0.0385;
            } else if (propertyPrice <= 17000) {
                notaryFees = propertyPrice * 0.0165 + 143.75;
            } else if (propertyPrice <= 60000) {
                notaryFees = propertyPrice * 0.011 + 236.25;
            } else {
                notaryFees = propertyPrice * 0.00825 + 406.25;
            }
            document.getElementById('notaryFees').value = notaryFees.toFixed(2);
        }

        function calculateProfitability() {
            const propertyPrice = parseFloat(document.getElementById('propertyPrice').value) || 0;
            const notaryFees = parseFloat(document.getElementById('notaryFees').value) || 0;
            const noLoan = document.getElementById('noLoan').checked;
            const downPayment = parseFloat(document.getElementById('downPayment').value) || 0;
            const loanAmount = parseFloat(document.getElementById('loanAmount').value) || 0;
            const loanDuration = parseFloat(document.getElementById('loanDuration').value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const monthlyRent = parseFloat(document.getElementById('monthlyRent').value) || 0;
            const propertyTax = parseFloat(document.getElementById('propertyTax').value) || 0;
            const coownershipCharges = parseFloat(document.getElementById('coownershipCharges').value) || 0;
            const insurance = parseFloat(document.getElementById('insurance').value) || 0;
            const managementFees = parseFloat(document.getElementById('managementFees').value) || 0;

            let monthlyLoanPayment = 0;
            if (!noLoan) {
                const monthlyRate = interestRate / 100 / 12;
                const numberOfPayments = loanDuration * 12;
                monthlyLoanPayment = (loanAmount * monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
            }

            const totalInvestment = propertyPrice + notaryFees;
            const annualRent = monthlyRent * 12;
            const annualCharges = propertyTax + coownershipCharges + insurance + (annualRent * managementFees / 100);
            const annualCashFlow = annualRent - annualCharges - (monthlyLoanPayment * 12);

            const grossYield = (annualRent / totalInvestment) * 100;
            const netYield = (annualCashFlow / totalInvestment) * 100;

            const resultatDiv = document.getElementById('resultat');
            const resultatsContenu = document.getElementById('resultatsContenu');
            resultatsContenu.innerHTML = `
                <p>Investissement total : ${totalInvestment.toFixed(2)} €</p>
                <p>Loyers annuels : ${annualRent.toFixed(2)} €</p>
                <p>Charges annuelles : ${annualCharges.toFixed(2)} €</p>
                <p>Mensualité du prêt : ${monthlyLoanPayment.toFixed(2)} €</p>
                <p>Cash-flow annuel : ${annualCashFlow.toFixed(2)} €</p>
                <p>Rentabilité brute : ${grossYield.toFixed(2)}%</p>
                <p>Rentabilité nette : ${netYield.toFixed(2)}%</p>
            `;
            resultatDiv.style.display = 'block';
        }

        // Initialisation
        window.onload = function() {
            toggleLoanFields();
            calculateNotaryFees();
        }
    </script>
</body>
</html>
